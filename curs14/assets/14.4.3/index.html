<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14.4.3 - Translation Lookaside Buffer (TLB)</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/lesson.css">
</head>
<body>
    <article class="lesson-container">
        <header class="lesson-header">
            <span class="lesson-badge">LecÈ›ia 14.4.3</span>
            <h1 class="lesson-title">Translation Lookaside Buffer (TLB)</h1>
            <p class="lesson-subtitle">Cache-ul pentru traduceri de adrese</p>
        </header>

        <section class="section" id="problema">
            <h2 class="section-title">Problema PerformanÈ›ei</h2>
            <p class="text-content">
                Fiecare acces la memorie necesitÄƒ traducerea adresei virtuale Ã®n adresÄƒ fizicÄƒ. 
                Cu page tables pe 4 niveluri, aceasta ar necesita <strong>4 accesuri suplimentare 
                la memorie</strong> pentru fiecare acces efectiv - o penalizare inacceptabilÄƒ!
            </p>

            <div class="info-box">
                <p class="info-title">ğŸ“Š FÄƒrÄƒ Optimizare</p>
                <p>
                    Un acces la date ar necesita: 4 accesuri pentru page walk + 1 acces pentru date 
                    = <strong>5x timpul normal</strong>. PerformanÈ›a ar scÄƒdea dramatic!
                </p>
            </div>
            <figure class="figure">
                <a href="../images/F78.png" target="_blank">
                    <img src="../images/F78.png" alt="Exemplu de transfer DMA" class="figure-img medium">
                </a>
                <figcaption class="figure-caption">
                    <strong>Figura 7.8:</strong> Exemplu de transfer DMA (DMAC = Controller DMA).
                </figcaption>
            </figure>
        </section>

        <section class="section" id="solutia-tlb">
            <h2 class="section-title">SoluÈ›ia: TLB</h2>

            <div class="definition-box">
                <p class="definition-label">DefiniÈ›ie</p>
                <p class="definition-text">
                    <strong>Translation Lookaside Buffer (TLB)</strong> este un cache specializat, 
                    mic È™i rapid, care stocheazÄƒ traducerile recente Virtual Page Number (VPN) â†’ 
                    Physical Frame Number (PFN). Numit È™i "address-translation cache".
                </p>
            </div>

            <div class="code-block">
<pre>Fluxul de Traducere cu TLB:
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ CACHE HIT       â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ PFN din TLB     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ HIT            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                             â–¼
â”‚ AdresÄƒ       â”‚â”€â”€â”€â”´â”€â”€â”€>â”Œâ”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VirtualÄƒ     â”‚        â”‚  TLB  â”‚                    â”‚ AdresÄƒ FizicÄƒ     â”‚
â”‚ (VPN+Offset) â”‚â”€â”€â”€â”¬â”€â”€â”€>â””â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ (PFN + Offset)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ MISS           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â–²
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ PAGE WALK       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ (4 accesuri)    â”‚
                                    â”‚ + Update TLB    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
            </div>

            <p class="text-content">
                DatoritÄƒ localitÄƒÈ›ii, majoritatea traducerilor sunt gÄƒsite Ã®n TLB (hit rate tipic: 
                <strong>95-99%</strong>), evitÃ¢nd costul page walk-ului.
            </p>
        </section>

        <section class="section" id="structura-tlb">
            <h2 class="section-title">Structura TLB</h2>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>CaracteristicÄƒ</th>
                        <th>TLB Tipic</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Dimensiune</td><td>32-2048 intrÄƒri</td></tr>
                    <tr><td>Asociativitate</td><td>Complet asociativ sau N-way (4-8)</td></tr>
                    <tr><td>Timp acces</td><td>0.5-1 ciclu (L1 TLB)</td></tr>
                    <tr><td>StructurÄƒ</td><td>L1 iTLB + L1 dTLB + L2 TLB unificat</td></tr>
                </tbody>
            </table>

            <h3>Intrare TLB</h3>
            <div class="code-block">
<pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VPN (Virtual Page Number) â”‚ PFN (Physical Frame) â”‚ Permisiuni â”‚
â”‚         20 biÈ›i           â”‚      20 biÈ›i         â”‚   V R W X  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚ â”‚ â”‚ â”‚ â”‚
                                                    â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Execute
                                                    â”‚ â”‚ â”‚ â””â”€â”€â”€â”€ eXecute disable
                                                    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€ Write
                                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ Read
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Valid</pre>
            </div>

            <div class="card-grid">
                <div class="info-card">
                    <div class="card-icon">ğŸ“˜</div>
                    <h3 class="card-title">L1 iTLB</h3>
                    <p class="card-text">
                        TLB pentru instrucÈ›iuni<br>
                        32-128 intrÄƒri<br>
                        Complet asociativ<br>
                        Acces Ã®n 1 ciclu
                    </p>
                </div>
                <div class="info-card">
                    <div class="card-icon">ğŸ“™</div>
                    <h3 class="card-title">L1 dTLB</h3>
                    <p class="card-text">
                        TLB pentru date<br>
                        32-128 intrÄƒri<br>
                        4-8 way asociativ<br>
                        Acces Ã®n 1 ciclu
                    </p>
                </div>
                <div class="info-card">
                    <div class="card-icon">ğŸ“—</div>
                    <h3 class="card-title">L2 TLB (STLB)</h3>
                    <p class="card-text">
                        Second-level unified<br>
                        512-4096 intrÄƒri<br>
                        6-12 way asociativ<br>
                        Acces Ã®n 6-12 cicluri
                    </p>
                </div>
            </div>
        </section>

        <section class="section" id="tlb-miss">
            <h2 class="section-title">TLB Miss Handling</h2>
            
            <p class="text-content">
                CÃ¢nd o traducere nu este Ã®n TLB (TLB miss), trebuie fÄƒcut un <strong>page walk</strong> 
                pentru a gÄƒsi traducerea Ã®n page table:
            </p>

            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-header">
                        <span>âš™ï¸ Hardware Page Walk (x86, ARM)</span>
                        <span class="icon-plus">+</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            <p>
                                MMU conÈ›ine un <strong>hardware page walker</strong> care traverseazÄƒ 
                                automat page table-ul. Procesorul poate continua execuÈ›ia speculativÄƒ 
                                Ã®n timpul page walk-ului.
                            </p>
                            <p><strong>Cost:</strong> 10-100 cicluri (depinde de niveluri È™i cache)</p>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-header">
                        <span>ğŸ”§ Software TLB Miss (MIPS, SPARC)</span>
                        <span class="icon-plus">+</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            <p>
                                TLB miss genereazÄƒ o excepÈ›ie, iar software-ul (OS kernel) traverseazÄƒ 
                                page table È™i insereazÄƒ traducerea Ã®n TLB.
                            </p>
                            <p><strong>Flexibilitate:</strong> Permite formate custom de page table</p>
                            <p><strong>Cost:</strong> Mai mare (100+ cicluri)</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="asid">
            <h2 class="section-title">ASID (Address Space Identifier)</h2>
            
            <p class="text-content">
                La schimbarea contextului Ã®ntre procese, TLB-ul ar trebui golit (toate traducerile 
                sunt ale procesului vechi). <strong>ASID</strong> evitÄƒ acest cost:
            </p>

            <div class="definition-box">
                <p class="definition-label">DefiniÈ›ie</p>
                <p class="definition-text">
                    <strong>ASID</strong> este un identificator scurt (8-16 biÈ›i) asociat fiecÄƒrei 
                    intrÄƒri TLB care identificÄƒ procesul. Traducerile cu ASID diferit nu se potrivesc, 
                    permiÈ›Ã¢nd TLB-ului sÄƒ pÄƒstreze traduceri de la mai multe procese simultan.
                </p>
            </div>

            <div class="code-block">
<pre>Intrare TLB cu ASID:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ASID    â”‚    VPN    â”‚    PFN    â”‚ Permisiuni â”‚
â”‚  (8 biÈ›i) â”‚ (44 biÈ›i) â”‚ (44 biÈ›i) â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Match = (ASID_curent == ASID_intrare) AND (VPN_cerut == VPN_intrare)
SAU (Global_bit == 1)  // pentru pagini kernel partajate</pre>
            </div>
        </section>

        <section class="section" id="tlb-coherence">
            <h2 class="section-title">TLB Coherency È™i Invalidare</h2>
            
            <p class="text-content">
                CÃ¢nd page table-ul este modificat (de exemplu, o paginÄƒ este mutatÄƒ sau are 
                permisiunile schimbate), intrÄƒrile TLB corespunzÄƒtoare trebuie invalidate:
            </p>

            <ul class="content-list">
                <li><strong>TLB Flush:</strong> GoleÈ™te Ã®ntregul TLB (costisitor)</li>
                <li><strong>INVLPG:</strong> InvalideazÄƒ o singurÄƒ paginÄƒ (x86)</li>
                <li><strong>TLB Shootdown:</strong> Invalidare pe toate CPU-urile Ã®ntr-un sistem multiprocesor (foarte costisitor)</li>
            </ul>

            <div class="info-box info-blue">
                <p class="info-title">âš ï¸ AtenÈ›ie la PerformanÈ›Äƒ</p>
                <p>
                    TLB shootdown Ã®n sisteme cu multe nuclee poate costa mii de cicluri È™i necesitÄƒ 
                    IPI (Inter-Processor Interrupts). Sisteme de operare moderne minimizeazÄƒ frecvenÈ›a.
                </p>
            </div>
        </section>

        <section class="section" id="metrici">
            <h2 class="section-title">Metrici de PerformanÈ›Äƒ TLB</h2>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>MetricÄƒ</th>
                        <th>Valoare TipicÄƒ</th>
                        <th>Impact</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>TLB Hit Rate</td><td>95-99.9%</td><td>Crucial pentru performanÈ›Äƒ</td></tr>
                    <tr><td>TLB Hit Time</td><td>0.5-1 ciclu</td><td>Suprapus cu cache access</td></tr>
                    <tr><td>TLB Miss Penalty</td><td>10-200 cicluri</td><td>Depinde de page walk</td></tr>
                    <tr><td>Acoperire L1 TLB</td><td>64 Ã— 4KB = 256 KB</td><td>Working set maxim rapid</td></tr>
                    <tr><td>Acoperire L2 TLB</td><td>1536 Ã— 4KB = 6 MB</td><td>Working set mai mare</td></tr>
                </tbody>
            </table>

            <div class="info-box info-green">
                <p class="info-title">ğŸ’¡ Huge Pages È™i TLB</p>
                <p>
                    Cu pagini de 2 MB Ã®n loc de 4 KB, fiecare intrare TLB acoperÄƒ 512x mai mult spaÈ›iu. 
                    Acoperirea L1 TLB creÈ™te de la 256 KB la <strong>128 MB</strong>!
                </p>
            </div>
        </section>

        <section class="section" id="sumar">
            <h2 class="section-title">Rezumat</h2>
            <div class="info-box info-green">
                <p class="info-title">ğŸ“ Puncte Cheie</p>
                <ul class="content-list">
                    <li><strong>TLB:</strong> Cache pentru traduceri VPN â†’ PFN</li>
                    <li>EvitÄƒ costul page walk-ului pentru majoritatea accesurilor</li>
                    <li>Hit rate tipic: 95-99%, esenÈ›ial pentru performanÈ›Äƒ</li>
                    <li><strong>ASID:</strong> Permite pÄƒstrarea traducerilor de la mai multe procese</li>
                    <li>TLB invalidation/shootdown poate fi costisitor Ã®n sisteme multicore</li>
                    <li>Huge pages cresc dramatic acoperirea TLB</li>
                </ul>
            </div>
        </section>

        <section class="section" id="final">
            <h2 class="section-title">ğŸ‰ FelicitÄƒri!</h2>
            <div class="info-box info-blue">
                <p class="info-title">Ai finalizat Cursul 14!</p>
                <p>
                    Acum Ã®nÈ›elegi principiile fundamentale ale ierarhiei de memorie, funcÈ›ionarea 
                    memoriei cache, optimizÄƒrile de performanÈ›Äƒ È™i sistemul de memorie virtualÄƒ. 
                    Aceste concepte sunt esenÈ›iale pentru Ã®nÈ›elegerea arhitecturii calculatoarelor 
                    moderne È™i pentru optimizarea software-ului.
                </p>
            </div>
        </section>
    </article>

    <script>
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const isExpanded = content.classList.contains('expanded');
                header.classList.toggle('active', !isExpanded);
                content.classList.toggle('expanded', !isExpanded);
            });
        });
    </script>
    <script src="../../js/lesson.js"></script>
</body>
</html>
